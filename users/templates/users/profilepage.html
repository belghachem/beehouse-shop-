{% load static %}
<!DOCTYPE html>
    <html>
        <head>
            <title>Bee House</title>
            <link rel="stylesheet" type="text/CSS" href="{% static 'CSS/profile-page_stylesheet.css' %}"/>
            <link rel="icon" type="image/x-icon" href="{% static 'Images/BEEBLACK.png' %}" />
            <meta charset="utf-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;600;700&display=swap" rel="stylesheet">
            <link rel="icon" type="image/x-icon" href="{% static 'Images/BEEBLACK.png' %}" />
    
</head>
    <body>
    <div class="header">
        <div class="logo"><img  class="beelogo" src="{% static 'Images/BEEBLACK.png' %}"> </div>
    <section class="nav-bar">
            
            <ol>
                <li><a href="{% url 'home:home_page' %}"><button class="nav-bar-button">Home</button></a></li>
                <li><a href="{% url 'products:product_page' %}"><button class="nav-bar-button">Products</button></a></li>
                <li><a href="{% url 'contactus:contact' %}"><button class="nav-bar-button">Contact-us</button></a></li>
            </ol>
    <div class="profile">
        <a href="{% url 'users:profile' %}"><img src="{% static 'Images/user_icon-profile.png' %}" alt="user-profile" class="user-profile">
        </a></div>
    </section>
    </div>
<div class="divider"></div>

    <!-- Dashboard Section -->
    <section class="dashboard-section">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h2>My Dashboard</h2>
                <p>Welcome back, <span class="user-name">{{ user.get_full_name|default:user.username }}</span>!</p>
            </div>
            
            <div class="dashboard-content">
                <!-- Sidebar -->
                <div class="dashboard-sidebar">
                    <div class="user-profile-card">
                        <div class="profile-avatar">
                            {% if profile.profile_picture %}
                                <img src="{{ profile.profile_picture.url }}" alt="Profile" class="avatar-img">
                            {% else %}
                                <img src="{% static 'Images/user_icon-profile.png' %}" alt="Profile" class="avatar-img">
                            {% endif %}
                            <button class="change-avatar-btn" onclick="document.getElementById('profile-pic-input').click()">Change Photo</button>
                            <input type="file" id="profile-pic-input" style="display: none;" accept="image/*">
                        </div>
                        <h3 class="profile-name">{{ user.get_full_name|default:user.username }}</h3>
                        <p class="profile-email">{{ user.email }}</p>
                        <p class="profile-phone">{{ profile.phone|default:"+213 XXX XXX XXX" }}</p>
                    </div>
                    
                    <nav class="dashboard-nav">
                        <ul>
                            <li><a href="#profile" class="nav-item">
                                <span>üë§</span> Profile Info
                            </a></li>
                            <li><a href="#orders" class="nav-item">
                                <span>üì¶</span> My Orders
                            </a></li>
                            <li><a href="#wishlist" class="nav-item">
                                <span>‚ù§Ô∏è</span> Wishlist
                            </a></li>
                            <li><a href="{% url 'users:logout' %}" class="nav-item logout">
                                <span>üö™</span> Logout
                            </a></li>
                        </ul>
                    </nav>
                </div>
                
                <!-- Main Content -->
                <div class="dashboard-main">
                    <!-- Stats Cards -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <h3>Total Orders</h3>
                            <p class="stat-number">{{ total_orders }}</p>
                        </div>
                        <div class="stat-card">
                            <h3>Pending Orders</h3>
                            <p class="stat-number">{{ pending_orders }}</p>
                        </div>
                        <div class="stat-card">
                            <h3>Total Spent</h3>
                            <p class="stat-number">{{ total_spent|floatformat:0 }} DA</p>
                        </div>
                    </div>
                    
                    <!-- Profile Form -->
                    <div class="dashboard-section-content" id="profile">
                        <h3>Profile Information</h3>
                        
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                            {% endfor %}
                        {% endif %}
                        
                        <form class="profile-form" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="form-group">
                                    <label>First Name</label>
                                    <input type="text" name="first_name" value="{{ user.first_name }}" required>
                                </div>
                                <div class="form-group">
                                    <label>Last Name</label>
                                    <input type="text" name="last_name" value="{{ user.last_name }}" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="email" value="{{ user.email }}" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" name="phone" value="{{ profile.phone }}">
                            </div>
                            
                            <div class="form-group">
                                <label>Address</label>
                                <textarea rows="3" name="address">{{ profile.address }}</textarea>
                            </div>
                            
                            <input type="file" name="profile_picture" style="display: none;">
                            
                            <button type="submit" class="save-btn">Save Changes</button>
                        </form>
                    </div>

                    <!-- Orders Section -->
                    <div class="dashboard-section-content" id="orders">
                        <h3>My Orders</h3>
                        <div class="orders-grid">
                            {% for order in recent_orders %}
                            <div class="order-card">
                                <div class="order-header">
                                    <span class="order-id">Order #{{ order.id }}</span>
                                    <span class="order-status status-{{ order.status }}">{{ order.get_status_display }}</span>
                                </div>
                                <div class="order-details">
                                    <div>
                                        <p><strong>Date:</strong> {{ order.created_at|date:"M d, Y" }}</p>
                                        <p><strong>Items:</strong> {{ order.items.count }} products</p>
                                    </div>
                                    <div>
                                        <p><strong>Total:</strong> {{ order.total_price|floatformat:0 }} DA</p>
                                        <p><strong>Payment:</strong> {{ order.get_payment_method_display }}</p>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <p>No orders yet. <a href="{% url 'products:product_page' %}">Start shopping!</a></p>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Wishlist Section -->
                    <div class="dashboard-section-content" id="wishlist">
                        <h3>My Wishlist</h3>
                        <div class="wishlist-grid">
                            {% for item in wishlist_items %}
                            <div class="wishlist-item">
                                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="wishlist-img">
                                <div class="wishlist-info">
                                    <h4>{{ item.product.name }}</h4>
                                    <p class="wishlist-price">{{ item.product.price|floatformat:0 }} DA</p>
                                    <div class="wishlist-actions">
                                        <a href="{% url 'cart:add_to_cart' item.product.id %}">
                                            <button class="wishlist-btn btn-cart">Add to Cart</button>
                                        </a>
                                        <a href="{% url 'users:remove_from_wishlist' item.id %}">
                                            <button class="wishlist-btn btn-remove">Remove</button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <p>Your wishlist is empty. <a href="{% url 'products:product_page' %}">Browse products!</a></p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
</html>